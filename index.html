<!DOCTYPE HTML>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Un mic cadou üíñ</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  background: #000;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

/* CANVAS ‚Äì mereu vizibil */
canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 1;
}

/* INTRO */
#introText {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 2em;
  text-align: center;
  opacity: 0;
  transition: opacity 1.5s ease;
  z-index: 5;
}

/* BUTON INIMƒÇ */
#heartButton {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 65px;
  height: 65px;
  background: hotpink;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  z-index: 10;
  display: none;
  box-shadow: 0 0 25px rgba(255,105,180,0.8);
  animation: pulse 1.2s infinite;
}

#heartButton::before {
  content: "‚ù§Ô∏è";
  font-size: 32px;
}

@keyframes pulse {
  0%   { transform: translate(-50%, -50%) scale(1); }
  50%  { transform: translate(-50%, -50%) scale(1.3); }
  100% { transform: translate(-50%, -50%) scale(1); }
}
</style>
</head>

<body>

<canvas id="pinkboard"></canvas>

<div id="introText">
  Un mic cadou pentru mica mea reginƒÉ üíñ
</div>

<button id="heartButton" onclick="goToLetter()"></button>

<script>
function goToLetter(){
  window.location.href = "letter.html";
}

/* INTRO FLOW */
const intro = document.getElementById("introText");
const heart = document.getElementById("heartButton");

setTimeout(() => intro.style.opacity = 1, 500);
setTimeout(() => intro.style.opacity = 0, 3500);
setTimeout(() => heart.style.display = "flex", 4200);
</script>

<script>
/* ===== INIMA CU PARTICULE ===== */

var settings = {
  particles: { length: 500, duration: 2, velocity: 100, effect: -0.75, size: 30 }
};

(function(){
  var Point=function(x,y){this.x=x||0;this.y=y||0;}
  Point.prototype.clone=function(){return new Point(this.x,this.y);}
  Point.prototype.length=function(l){if(l===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);this.normalize();this.x*=l;this.y*=l;return this;}
  Point.prototype.normalize=function(){var l=this.length();this.x/=l;this.y/=l;return this;}

  var Particle=function(){this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0;}
  Particle.prototype.initialize=function(x,y,dx,dy){
    this.position.x=x;this.position.y=y;
    this.velocity.x=dx;this.velocity.y=dy;
    this.acceleration.x=dx*settings.particles.effect;
    this.acceleration.y=dy*settings.particles.effect;
    this.age=0;
  }
  Particle.prototype.update=function(dt){
    this.position.x+=this.velocity.x*dt;
    this.position.y+=this.velocity.y*dt;
    this.velocity.x+=this.acceleration.x*dt;
    this.velocity.y+=this.acceleration.y*dt;
    this.age+=dt;
  }
  Particle.prototype.draw=function(ctx,img){
    var ease=t=>--t*t*t+1;
    var size=img.width*ease(this.age/settings.particles.duration);
    ctx.globalAlpha=1-this.age/settings.particles.duration;
    ctx.drawImage(img,this.position.x-size/2,this.position.y-size/2,size,size);
  }

  var ParticlePool=function(len){
    this.particles=[...Array(len)].map(()=>new Particle());
    this.firstActive=0;this.firstFree=0;this.duration=settings.particles.duration;
  }
  ParticlePool.prototype.add=function(x,y,dx,dy){
    this.particles[this.firstFree].initialize(x,y,dx,dy);
    this.firstFree=(this.firstFree+1)%this.particles.length;
    if(this.firstActive===this.firstFree)this.firstActive=(this.firstActive+1)%this.particles.length;
  }
  ParticlePool.prototype.update=function(dt){
    let i=this.firstActive;
    while(i!==this.firstFree){
      this.particles[i].update(dt);
      if(this.particles[i].age>=this.duration)this.firstActive=(this.firstActive+1)%this.particles.length;
      i=(i+1)%this.particles.length;
    }
  }
  ParticlePool.prototype.draw=function(ctx,img){
    let i=this.firstActive;
    while(i!==this.firstFree){
      this.particles[i].draw(ctx,img);
      i=(i+1)%this.particles.length;
    }
  }

  var canvas=document.getElementById("pinkboard");
  var ctx=canvas.getContext("2d");
  var pool=new ParticlePool(settings.particles.length);
  var rate=settings.particles.length/settings.particles.duration;
  var time;

  function pointOnHeart(t){
    return new Point(
      160*Math.pow(Math.sin(t),3),
      130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
    );
  }

  var image=(function(){
    var c=document.createElement("canvas");
    c.width=c.height=settings.particles.size;
    var x=c.getContext("2d");
    x.fillStyle="#ea80b0";
    x.beginPath();
    for(let t=-Math.PI;t<=Math.PI;t+=0.01){
      let p=pointOnHeart(t);
      x.lineTo(c.width/2+p.x*c.width/350,c.height/2-p.y*c.height/350);
    }
    x.fill();
    var i=new Image();i.src=c.toDataURL();return i;
  })();

  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
  window.onresize=resize;resize();

  function render(){
    requestAnimationFrame(render);
    let now=Date.now()/1000;
    let dt=now-(time||now);time=now;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(let i=0;i<rate*dt;i++){
      let p=pointOnHeart(Math.random()*Math.PI*2);
      let d=p.clone().length(settings.particles.velocity);
      pool.add(canvas.width/2+p.x,canvas.height/2-p.y,d.x,-d.y);
    }

    pool.update(dt);
    pool.draw(ctx,image);
  }
  render();
})();
</script>

</body>
</html>
